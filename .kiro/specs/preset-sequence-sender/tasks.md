# Implementation Plan

## Tasks

- [x] 1. プリセット一覧取得APIの実装
- [x] 1.1 (P) プリセットメタ情報の型定義を追加
  - プリセット一覧レスポンス用の型を定義
  - ID、シーケンス名、ファイル名、台本件数を含む構造
  - 既存の`scriptTypes.ts`に追加
  - _Requirements: 5.2, 5.3_

- [x] 1.2 プリセット一覧APIエンドポイントを作成
  - `samples/`フォルダ内のJSONファイルをスキャン
  - 各ファイルのメタ情報（名前、件数）を抽出して返却
  - フォルダ不在やファイル読み込みエラー時は空配列を返却
  - 既存の`/api/scripts`パターンに準拠
  - _Requirements: 5.1, 5.2, 5.3_

- [x] 1.3 個別プリセット取得機能を追加
  - クエリパラメータ`id`で指定されたファイルの完全な内容を返却
  - 存在しないIDの場合は404エラーを返却
  - `parseScriptSequence`を使用してバリデーション
  - _Requirements: 5.4_

- [x] 2. useScriptAutoSenderフックの拡張
- [x] 2.1 パース済みデータを直接読み込むメソッドを追加
  - `loadSequenceFromData`メソッドを実装
  - 既存の`loadSequence`内のパース後処理を共通化
  - バリデーション済みのScriptSequenceを受け取り状態を更新
  - _Requirements: 2.1_

- [x] 3. ScriptAutoSenderPanelのプリセット機能追加
- [x] 3.1 プリセット一覧取得のステート管理を追加
  - プリセット一覧、ローディング状態、エラー状態を管理
  - コンポーネントマウント時にAPIから一覧を取得
  - 取得失敗時はエラーメッセージを保持
  - _Requirements: 1.1_

- [x] 3.2 プリセット一覧の表示UIを実装
  - 各プリセットのシーケンス名と台本件数を表示
  - プリセットが存在しない場合は「プリセットがありません」を表示
  - 既存のファイル選択UIの上部に配置
  - _Requirements: 1.2, 1.3, 1.4_

- [x] 3.3 プリセット選択時の読み込み処理を実装
  - プリセットクリックでAPIから詳細を取得
  - 取得中はローディング状態を表示
  - 取得完了後は`loadSequenceFromData`で読み込み
  - 読み込み失敗時はエラーメッセージを表示
  - _Requirements: 2.1, 2.2, 2.3, 2.4_

- [x] 3.4 プリセット一覧の更新機能を実装
  - 更新ボタンを表示
  - クリックでAPIを再呼び出しして一覧を更新
  - 更新処理中はボタンを無効化
  - _Requirements: 3.1, 3.2, 3.3_

- [x] 3.5 プリセット選択とファイル選択の排他制御を実装
  - 既存のファイル選択ボタンを維持
  - ファイル選択時にプリセット選択状態をクリア
  - プリセット選択時にファイル読み込み状態をクリア
  - _Requirements: 4.1, 4.2, 4.3_

- [x] 4. 統合テストとUIテスト
- [x] 4.1 (P) APIエンドポイントのテストを作成
  - 一覧取得の正常系・異常系テスト
  - 個別取得の正常系・404ケースのテスト
  - _Requirements: 5.1, 5.2, 5.3, 5.4_

- [x] 4.2 ScriptAutoSenderPanelのテストを追加
  - プリセット一覧表示のテスト
  - プリセット選択→シーケンス読み込みのテスト
  - ファイル選択との排他動作のテスト
  - _Requirements: 1.1, 1.2, 1.3, 1.4, 2.1, 2.2, 2.3, 2.4, 3.1, 3.2, 3.3, 4.1, 4.2, 4.3_

## Requirements Coverage

| Requirement | Tasks |
|-------------|-------|
| 1.1 | 3.1 |
| 1.2 | 3.2 |
| 1.3 | 3.2 |
| 1.4 | 3.2 |
| 2.1 | 2.1, 3.3 |
| 2.2 | 3.3 |
| 2.3 | 3.3 |
| 2.4 | 3.3 |
| 3.1 | 3.4 |
| 3.2 | 3.4 |
| 3.3 | 3.4 |
| 4.1 | 3.5 |
| 4.2 | 3.5 |
| 4.3 | 3.5 |
| 5.1 | 1.2, 4.1 |
| 5.2 | 1.1, 1.2, 4.1 |
| 5.3 | 1.1, 1.2, 4.1 |
| 5.4 | 1.3, 4.1 |
